- job:
    name: nebulous-cloud-fog-service-broker-build-container-images
    parent: nebulous-build-container-images
    dependencies:
      - name: opendev-buildset-registry
        soft: false
    provides:
      - nebulous-cloud-fog-service-broker-container-images
    description: Build the container images for both the backend and frontend.
    files: &image_files
      - ^cfsb-backend/
      - ^cfsb-frontend/
    vars: &image_vars
      promote_container_image_job: nebulous-cloud-fog-service-broker-upload-container-images
      container_images:
        - context: cfsb-backend
          registry: quay.io
          repository: quay.io/nebulous/cloud-fog-service-broker-backend
          namespace: nebulous
          repo_shortname: cloud-fog-service-broker-backend
          repo_description: ""
          tags: ["r1-latest"]
        - context: cfsb-frontend
          registry: quay.io
          repository: quay.io/nebulous/cloud-fog-service-broker-frontend
          namespace: nebulous
          repo_shortname: cloud-fog-service-broker-frontend
          repo_description: ""
          tags: ["r1-latest"]

- job:
    name: nebulous-cloud-fog-service-broker-upload-container-images
    parent: nebulous-upload-container-images
    dependencies:
      - name: opendev-buildset-registry
        soft: false
    provides:
      - nebulous-cloud-fog-service-broker-container-images
    description: Build and upload both the backend and frontend container images.
    files: *image_files
    vars: *image_vars

- job:
    name: nebulous-cloud-fog-service-broker-promote-container-images
    parent: nebulous-promote-container-images
    description: Promote previously uploaded backend and frontend container images.
    files: *image_files
    vars: *image_vars

- job:
    name: nebulous-cloud-fog-service-broker-hadolint
    parent: nebulous-hadolint
    description: Run Hadolint on Dockerfile(s).
    vars:
      dockerfiles:
        - cfsb-backend/Dockerfile
        - cfsb-frontend/Dockerfile

- job:
    name: nebulous-cloud-fog-service-broker-helm-lint
    parent: nebulous-helm-lint
    description: Run helm lint on Helm charts.
    vars:
      helm_charts:
        - ./charts/nebulous-cloud-fog-service-broker

- job:
    name: nebulous-cloud-fog-service-broker-apply-helm-charts
    parent: nebulous-apply-helm-charts
    dependencies:
      - name: opendev-buildset-registry
        soft: false
      - name: nebulous-cloud-fog-service-broker-build-container-images
        soft: true
      - name: nebulous-cloud-fog-service-broker-upload-container-images
        soft: true
    requires:
      - nebulous-cloud-fog-service-broker-container-images
    description: Deploy a Kubernetes cluster and apply charts.
    vars:
      helm_charts:
        nebulous-cloud-fog-service-broker: ./charts/nebulous-cloud-fog-service-broker
